generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Subscriber {
  id         Int       @id @default(autoincrement())
  matricula  String    @unique
  documento   String   @unique
  apellidos  String
  nombres    String
  correo     String?
  estrato    Int?
  telefono   String?
  sector     String?
  no_personas Int?
  direccion  String?
  readings   Reading[]
  credits    Credit[]
  createdAt  DateTime  @default(now())
}

model Reading {
  id             Int      @id @default(autoincrement())
  subscriberId   Int
  ciclo          String   // Ej: "2026-1" (año-ciclo)
  lecturaAnterior Float    // Valor anterior del contador
  lecturaActual  Float    // Valor actual del contador
  consumo        Float    // Calculado: lecturaActual - lecturaAnterior
  valorTotal     Float    // Calculado: tarifa aplicada
  fecha          DateTime @default(now())
  estado         String   @default("pendiente")
  subscriber     Subscriber @relation(fields: [subscriberId], references: [id])
  invoice        Invoice?
}

model Invoice {
  id           Int      @id @default(autoincrement())
  readingId    Int      @unique
  total        Float
  estado       String   @default("pendiente")
  fecha        DateTime @default(now())
  reading      Reading  @relation(fields: [readingId], references: [id])
}

model Credit {
  id           Int      @id @default(autoincrement())
  subscriberId Int
  amount       Int
  description  String?
  createdAt    DateTime @default(now())
  subscriber   Subscriber @relation(fields: [subscriberId], references: [id])
  payments     CreditPayment[]
}

model CreditPayment {
  id        Int      @id @default(autoincrement())
  creditId  Int
  amount    Int
  createdAt DateTime @default(now())
  credit    Credit   @relation(fields: [creditId], references: [id])
}

model Role {
  id          Int     @id @default(autoincrement())
  name        String  @unique
  description String?
  users       User[]
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String?
  password  String?
  roleId    Int?
  role      Role?    @relation(fields: [roleId], references: [id])
  createdAt DateTime @default(now())
}

/// Configuration/settings for the acueducto — single row expected
model Config {
  id           Int      @id @default(autoincrement())
  name         String   @default("Acueducto Rural")
  nit          String?
  logoUrl      String?
  phone        String?
  address      String?
  basicTariff  Int      @default(25000)
  threshold    Int      @default(40)
  unitPrice    Int      @default(1500)
  currency     String   @default("COP")
  updatedAt    DateTime @updatedAt
  createdAt    DateTime @default(now())
}